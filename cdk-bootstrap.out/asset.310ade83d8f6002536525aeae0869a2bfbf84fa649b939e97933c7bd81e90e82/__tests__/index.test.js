"use strict";
// Unit tests for Triage Engine Lambda function
// Tests specific examples and integration points
Object.defineProperty(exports, "__esModule", { value: true });
const types_1 = require("../../../types");
// Mock AWS clients before importing the handler
const mockDocClientSend = jest.fn();
const mockBedrockClientSend = jest.fn();
jest.mock('@aws-sdk/lib-dynamodb', () => ({
    DynamoDBDocumentClient: {
        from: jest.fn(() => ({
            send: mockDocClientSend
        }))
    },
    GetCommand: jest.fn((params) => params),
    UpdateCommand: jest.fn((params) => params)
}));
jest.mock('@aws-sdk/client-dynamodb', () => ({
    DynamoDBClient: jest.fn()
}));
jest.mock('@aws-sdk/client-bedrock-runtime', () => ({
    BedrockRuntimeClient: jest.fn(() => ({
        send: mockBedrockClientSend
    })),
    InvokeModelCommand: jest.fn((params) => params)
}));
// Import handler after mocking
const index_1 = require("../index");
// Set environment variables
process.env.EPISODE_TABLE_NAME = 'test-episodes-table';
process.env.AWS_REGION = 'us-east-1';
describe('Triage Engine Lambda Handler', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    const createMockEvent = (body) => ({
        body: JSON.stringify(body),
        headers: {},
        multiValueHeaders: {},
        httpMethod: 'POST',
        isBase64Encoded: false,
        path: '/triage',
        pathParameters: null,
        queryStringParameters: null,
        multiValueQueryStringParameters: null,
        stageVariables: null,
        requestContext: {},
        resource: ''
    });
    const createMockEpisode = (episodeId) => ({
        episodeId,
        patientId: 'patient-123',
        status: types_1.EpisodeStatus.ACTIVE,
        symptoms: {
            primaryComplaint: 'chest pain',
            duration: '2 hours',
            severity: 8,
            associatedSymptoms: ['shortness of breath'],
            inputMethod: types_1.InputMethod.TEXT
        },
        interactions: [],
        createdAt: new Date(),
        updatedAt: new Date()
    });
    describe('Input Validation', () => {
        it('should return 400 when episodeId is missing', async () => {
            const event = createMockEvent({});
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(400);
            expect(JSON.parse(result.body)).toEqual({
                error: 'Missing required field: episodeId'
            });
        });
        it('should return 400 when body is invalid JSON', async () => {
            const event = {
                ...createMockEvent({}),
                body: 'invalid json'
            };
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(500);
            expect(JSON.parse(result.body)).toEqual({
                error: 'Internal server error during triage assessment'
            });
        });
    });
    describe('Episode Retrieval', () => {
        it('should return 404 when episode is not found', async () => {
            const event = createMockEvent({ episodeId: 'non-existent' });
            mockDocClientSend.mockResolvedValueOnce({ Item: null });
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(404);
            expect(JSON.parse(result.body)).toEqual({
                error: 'Episode not found'
            });
        });
        it('should return existing triage if episode already assessed', async () => {
            const episodeId = 'episode-123';
            const existingTriage = {
                urgencyLevel: types_1.UrgencyLevel.URGENT,
                ruleBasedScore: 80,
                aiAssessment: { used: false },
                finalScore: 80
            };
            const episode = {
                ...createMockEpisode(episodeId),
                triage: existingTriage
            };
            const event = createMockEvent({ episodeId });
            mockDocClientSend.mockResolvedValueOnce({ Item: episode });
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.message).toBe('Episode already has triage assessment');
            expect(body.triage).toEqual(existingTriage);
        });
    });
    describe('Triage Assessment', () => {
        it('should perform rule-based triage for emergency symptoms', async () => {
            const episodeId = 'episode-123';
            const episode = createMockEpisode(episodeId);
            const event = createMockEvent({ episodeId });
            // Mock episode retrieval
            mockDocClientSend.mockResolvedValueOnce({ Item: episode });
            // Mock episode update
            mockDocClientSend.mockResolvedValueOnce({});
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.message).toBe('Triage assessment completed successfully');
            expect(body.triage.urgencyLevel).toBe(types_1.UrgencyLevel.EMERGENCY);
            expect(body.triage.ruleBasedScore).toBeGreaterThan(90);
            expect(body.nextSteps).toContain('Immediate medical attention');
        });
        it('should perform rule-based triage for routine symptoms', async () => {
            const episodeId = 'episode-123';
            const episode = {
                ...createMockEpisode(episodeId),
                symptoms: {
                    primaryComplaint: 'mild headache',
                    duration: '1 day',
                    severity: 4,
                    associatedSymptoms: [],
                    inputMethod: types_1.InputMethod.TEXT
                }
            };
            const event = createMockEvent({ episodeId });
            // Mock episode retrieval
            mockDocClientSend.mockResolvedValueOnce({ Item: episode });
            // Mock episode update
            mockDocClientSend.mockResolvedValueOnce({});
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.triage.urgencyLevel).toBe(types_1.UrgencyLevel.ROUTINE);
            expect(body.nextSteps).toContain('Routine care');
        });
        it('should handle self-care symptoms', async () => {
            const episodeId = 'episode-123';
            const episode = {
                ...createMockEpisode(episodeId),
                symptoms: {
                    primaryComplaint: 'minor scratch',
                    duration: '1 hour',
                    severity: 2,
                    associatedSymptoms: [],
                    inputMethod: types_1.InputMethod.TEXT
                }
            };
            const event = createMockEvent({ episodeId });
            // Mock episode retrieval
            mockDocClientSend.mockResolvedValueOnce({ Item: episode });
            // Mock episode update
            mockDocClientSend.mockResolvedValueOnce({});
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.triage.urgencyLevel).toBe(types_1.UrgencyLevel.SELF_CARE);
            expect(body.nextSteps).toContain('Self-care');
        });
    });
    describe('Error Handling', () => {
        it('should handle DynamoDB errors gracefully', async () => {
            const event = createMockEvent({ episodeId: 'episode-123' });
            mockDocClientSend.mockRejectedValueOnce(new Error('DynamoDB error'));
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(500);
            expect(JSON.parse(result.body)).toEqual({
                error: 'Internal server error during triage assessment'
            });
        });
        it('should handle AI service errors by falling back to rule-based assessment', async () => {
            const episodeId = 'episode-123';
            const episode = {
                ...createMockEpisode(episodeId),
                symptoms: {
                    primaryComplaint: 'complex symptoms with multiple issues',
                    duration: 'several days',
                    severity: 6,
                    associatedSymptoms: ['fatigue', 'dizziness', 'nausea', 'weakness'],
                    inputMethod: types_1.InputMethod.TEXT
                }
            };
            const event = createMockEvent({ episodeId });
            // Mock episode retrieval
            mockDocClientSend.mockResolvedValueOnce({ Item: episode });
            // Mock Bedrock error
            mockBedrockClientSend.mockRejectedValueOnce(new Error('Bedrock error'));
            // Mock episode update
            mockDocClientSend.mockResolvedValueOnce({});
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.triage.aiAssessment.used).toBe(false);
            expect(body.triage.urgencyLevel).toBeDefined();
        });
        it('should enforce cost control by limiting one AI call per episode', async () => {
            const episodeId = 'episode-123';
            const episode = {
                ...createMockEpisode(episodeId),
                symptoms: {
                    primaryComplaint: 'complex symptoms requiring AI assessment',
                    duration: 'several days',
                    severity: 6,
                    associatedSymptoms: ['fatigue', 'dizziness', 'nausea', 'weakness'],
                    inputMethod: types_1.InputMethod.TEXT
                },
                triage: {
                    urgencyLevel: types_1.UrgencyLevel.ROUTINE,
                    ruleBasedScore: 55,
                    aiAssessment: { used: true, confidence: 0.8, reasoning: 'Previous AI assessment' },
                    finalScore: 60
                }
            };
            const event = createMockEvent({ episodeId });
            // Mock episode retrieval with existing AI assessment
            mockDocClientSend.mockResolvedValueOnce({ Item: episode });
            // Mock episode update
            mockDocClientSend.mockResolvedValueOnce({});
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(200);
            const body = JSON.parse(result.body);
            expect(body.message).toBe('Episode already has triage assessment');
            // Verify Bedrock was not called
            expect(mockBedrockClientSend).not.toHaveBeenCalled();
        });
    });
    describe('Response Format', () => {
        it('should return properly formatted response with CORS headers', async () => {
            const episodeId = 'episode-123';
            const episode = createMockEpisode(episodeId);
            const event = createMockEvent({ episodeId });
            // Mock episode retrieval - ensure the episode is returned
            mockDocClientSend
                .mockResolvedValueOnce({ Item: episode }) // First call: getEpisode
                .mockResolvedValueOnce({}); // Second call: updateEpisodeWithTriage
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(200);
            expect(result.headers).toEqual({
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            });
            const body = JSON.parse(result.body);
            expect(body).toHaveProperty('message');
            expect(body).toHaveProperty('episodeId');
            expect(body).toHaveProperty('triage');
            expect(body).toHaveProperty('nextSteps');
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXgudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9sYW1iZGEvdHJpYWdlLWVuZ2luZS9fX3Rlc3RzX18vaW5kZXgudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsK0NBQStDO0FBQy9DLGlEQUFpRDs7QUFHakQsMENBQW1GO0FBRW5GLGdEQUFnRDtBQUNoRCxNQUFNLGlCQUFpQixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUNwQyxNQUFNLHFCQUFxQixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUV4QyxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDeEMsc0JBQXNCLEVBQUU7UUFDdEIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUNuQixJQUFJLEVBQUUsaUJBQWlCO1NBQ3hCLENBQUMsQ0FBQztLQUNKO0lBQ0QsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQztJQUN2QyxhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDO0NBQzNDLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLElBQUksQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzNDLGNBQWMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQzFCLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLElBQUksQ0FBQyxpQ0FBaUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2xELG9CQUFvQixFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNuQyxJQUFJLEVBQUUscUJBQXFCO0tBQzVCLENBQUMs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QUFDLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFVuaXQgdGVzdHMgZm9yIFRyaWFnZSBFbmdpbmUgTGFtYmRhIGZ1bmN0aW9uXHJcbi8vIFRlc3RzIHNwZWNpZmljIGV4YW1wbGVzIGFuZCBpbnRlZ3JhdGlvbiBwb2ludHNcclxuXHJcbmltcG9ydCB7IEFQSUdhdGV3YXlQcm94eUV2ZW50IH0gZnJvbSAnYXdzLWxhbWJkYSc7XHJcbmltcG9ydCB7IEVwaXNvZGUsIFVyZ2VuY3lMZXZlbCwgRXBpc29kZVN0YXR1cywgSW5wdXRNZXRob2QgfSBmcm9tICcuLi8uLi8uLi90eXBlcyc7XHJcblxyXG4vLyBNb2NrIEFXUyBjbGllbnRzIGJlZm9yZSBpbXBvcnRpbmcgdGhlIGhhbmRsZXJcclxuY29uc3QgbW9ja0RvY0NsaWVudFNlbmQgPSBqZXN0LmZuKCk7XHJcbmNvbnN0IG1vY2tCZWRyb2NrQ2xpZW50U2VuZCA9IGplc3QuZm4oKTtcclxuXHJcbmplc3QubW9jaygnQGF3cy1zZGsvbGliLWR5bmFtb2RiJywgKCkgPT4gKHtcclxuICBEeW5hbW9EQkRvY3VtZW50Q2xpZW50OiB7XHJcbiAgICBmcm9tOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgIHNlbmQ6IG1vY2tEb2NDbGllbnRTZW5kXHJcbiAgICB9KSlcclxuICB9LFxyXG4gIEdldENvbW1hbmQ6IGplc3QuZm4oKHBhcmFtcykgPT4gcGFyYW1zKSxcclxuICBVcGRhdGVDb21tYW5kOiBqZXN0LmZuKChwYXJhbXMpID0+IHBhcmFtcylcclxufSkpO1xyXG5cclxuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtZHluYW1vZGInLCAoKSA9PiAoe1xyXG4gIER5bmFtb0RCQ2xpZW50OiBqZXN0LmZuKClcclxufSkpO1xyXG5cclxuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtYmVkcm9jay1ydW50aW1lJywgKCkgPT4gKHtcclxuICBCZWRyb2NrUnVudGltZUNsaWVudDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgc2VuZDogbW9ja0JlZHJvY2tDbGllbnRTZW5kXHJcbiAgfSkpLFxyXG4gIEludm9rZU1vZGVsQ29tbWFuZDogamVzdC5mbigocGFyYW1zKSA9PiBwYXJhbXMpXHJcbn0pKTtcclxuXHJcbi8vIEltcG9ydCBoYW5kbGVyIGFmdGVyIG1vY2tpbmdcclxuaW1wb3J0IHsgaGFuZGxlciB9IGZyb20gJy4uL2luZGV4JztcclxuXHJcbi8vIFNldCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcclxucHJvY2Vzcy5lbnYuRVBJU09ERV9UQUJMRV9OQU1FID0gJ3Rlc3QtZXBpc29kZXMtdGFibGUnO1xyXG5wcm9jZXNzLmVudi5BV1NfUkVHSU9OID0gJ3VzLWVhc3QtMSc7XHJcblxyXG5kZXNjcmliZSgnVHJpYWdlIEVuZ2luZSBMYW1iZGEgSGFuZGxlcicsICgpID0+IHtcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCBjcmVhdGVNb2NrRXZlbnQgPSAoYm9keTogYW55KTogQVBJR2F0ZXdheVByb3h5RXZlbnQgPT4gKHtcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpLFxyXG4gICAgaGVhZGVyczoge30sXHJcbiAgICBtdWx0aVZhbHVlSGVhZGVyczoge30sXHJcbiAgICBodHRwTWV0aG9kOiAnUE9TVCcsXHJcbiAgICBpc0Jhc2U2NEVuY29kZWQ6IGZhbHNlLFxyXG4gICAgcGF0aDogJy90cmlhZ2UnLFxyXG4gICAgcGF0aFBhcmFtZXRlcnM6IG51bGwsXHJcbiAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnM6IG51bGwsXHJcbiAgICBtdWx0aVZhbHVlUXVlcnlTdHJpbmdQYXJhbWV0ZXJzOiBudWxsLFxyXG4gICAgc3RhZ2VWYXJpYWJsZXM6IG51bGwsXHJcbiAgICByZXF1ZXN0Q29udGV4dDoge30gYXMgYW55LFxyXG4gICAgcmVzb3VyY2U6ICcnXHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IGNyZWF0ZU1vY2tFcGlzb2RlID0gKGVwaXNvZGVJZDogc3RyaW5nKTogRXBpc29kZSA9PiAoe1xyXG4gICAgZXBpc29kZUlkLFxyXG4gICAgcGF0aWVudElkOiAncGF0aWVudC0xMjMnLFxyXG4gICAgc3RhdHVzOiBFcGlzb2RlU3RhdHVzLkFDVElWRSxcclxuICAgIHN5bXB0b21zOiB7XHJcbiAgICAgIHByaW1hcnlDb21wbGFpbnQ6ICdjaGVzdCBwYWluJyxcclxuICAgICAgZHVyYXRpb246ICcyIGhvdXJzJyxcclxuICAgICAgc2V2ZXJpdHk6IDgsXHJcbiAgICAgIGFzc29jaWF0ZWRTeW1wdG9tczogWydzaG9ydG5lc3Mgb2YgYnJlYXRoJ10sXHJcbiAgICAgIGlucHV0TWV0aG9kOiBJbnB1dE1ldGhvZC5URVhUXHJcbiAgICB9LFxyXG4gICAgaW50ZXJhY3Rpb25zOiBbXSxcclxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnSW5wdXQgVmFsaWRhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDQwMCB3aGVuIGVwaXNvZGVJZCBpcyBtaXNzaW5nJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZU1vY2tFdmVudCh7fSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKGV2ZW50KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSg0MDApO1xyXG4gICAgICBleHBlY3QoSlNPTi5wYXJzZShyZXN1bHQuYm9keSkpLnRvRXF1YWwoe1xyXG4gICAgICAgIGVycm9yOiAnTWlzc2luZyByZXF1aXJlZCBmaWVsZDogZXBpc29kZUlkJ1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDQwMCB3aGVuIGJvZHkgaXMgaW52YWxpZCBKU09OJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBldmVudDogQVBJR2F0ZXdheVByb3h5RXZlbnQgPSB7XHJcbiAgICAgICAgLi4uY3JlYXRlTW9ja0V2ZW50KHt9KSxcclxuICAgICAgICBib2R5OiAnaW52YWxpZCBqc29uJ1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoNTAwKTtcclxuICAgICAgZXhwZWN0KEpTT04ucGFyc2UocmVzdWx0LmJvZHkpKS50b0VxdWFsKHtcclxuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvciBkdXJpbmcgdHJpYWdlIGFzc2Vzc21lbnQnXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdFcGlzb2RlIFJldHJpZXZhbCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDQwNCB3aGVuIGVwaXNvZGUgaXMgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZU1vY2tFdmVudCh7IGVwaXNvZGVJZDogJ25vbi1leGlzdGVudCcgfSk7XHJcbiAgICAgIFxyXG4gICAgICBtb2NrRG9jQ2xpZW50U2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBJdGVtOiBudWxsIH0pO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoNDA0KTtcclxuICAgICAgZXhwZWN0KEpTT04ucGFyc2UocmVzdWx0LmJvZHkpKS50b0VxdWFsKHtcclxuICAgICAgICBlcnJvcjogJ0VwaXNvZGUgbm90IGZvdW5kJ1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGV4aXN0aW5nIHRyaWFnZSBpZiBlcGlzb2RlIGFscmVhZHkgYXNzZXNzZWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVwaXNvZGVJZCA9ICdlcGlzb2RlLTEyMyc7XHJcbiAgICAgIGNvbnN0IGV4aXN0aW5nVHJpYWdlID0ge1xyXG4gICAgICAgIHVyZ2VuY3lMZXZlbDogVXJnZW5jeUxldmVsLlVSR0VOVCxcclxuICAgICAgICBydWxlQmFzZWRTY29yZTogODAsXHJcbiAgICAgICAgYWlBc3Nlc3NtZW50OiB7IHVzZWQ6IGZhbHNlIH0sXHJcbiAgICAgICAgZmluYWxTY29yZTogODBcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGVwaXNvZGUgPSB7XHJcbiAgICAgICAgLi4uY3JlYXRlTW9ja0VwaXNvZGUoZXBpc29kZUlkKSxcclxuICAgICAgICB0cmlhZ2U6IGV4aXN0aW5nVHJpYWdlXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZU1vY2tFdmVudCh7IGVwaXNvZGVJZCB9KTtcclxuICAgICAgbW9ja0RvY0NsaWVudFNlbmQubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgSXRlbTogZXBpc29kZSB9KTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIoZXZlbnQpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXNDb2RlKS50b0JlKDIwMCk7XHJcbiAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHJlc3VsdC5ib2R5KTtcclxuICAgICAgZXhwZWN0KGJvZHkubWVzc2FnZSkudG9CZSgnRXBpc29kZSBhbHJlYWR5IGhhcyB0cmlhZ2UgYXNzZXNzbWVudCcpO1xyXG4gICAgICBleHBlY3QoYm9keS50cmlhZ2UpLnRvRXF1YWwoZXhpc3RpbmdUcmlhZ2UpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdUcmlhZ2UgQXNzZXNzbWVudCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcGVyZm9ybSBydWxlLWJhc2VkIHRyaWFnZSBmb3IgZW1lcmdlbmN5IHN5bXB0b21zJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBlcGlzb2RlSWQgPSAnZXBpc29kZS0xMjMnO1xyXG4gICAgICBjb25zdCBlcGlzb2RlID0gY3JlYXRlTW9ja0VwaXNvZGUoZXBpc29kZUlkKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KHsgZXBpc29kZUlkIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayBlcGlzb2RlIHJldHJpZXZhbFxyXG4gICAgICBtb2NrRG9jQ2xpZW50U2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBJdGVtOiBlcGlzb2RlIH0pO1xyXG4gICAgICAvLyBNb2NrIGVwaXNvZGUgdXBkYXRlXHJcbiAgICAgIG1vY2tEb2NDbGllbnRTZW5kLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7fSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKGV2ZW50KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xyXG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShyZXN1bHQuYm9keSk7XHJcbiAgICAgIGV4cGVjdChib2R5Lm1lc3NhZ2UpLnRvQmUoJ1RyaWFnZSBhc3Nlc3NtZW50IGNvbXBsZXRlZCBzdWNjZXNzZnVsbHknKTtcclxuICAgICAgZXhwZWN0KGJvZHkudHJpYWdlLnVyZ2VuY3lMZXZlbCkudG9CZShVcmdlbmN5TGV2ZWwuRU1FUkdFTkNZKTtcclxuICAgICAgZXhwZWN0KGJvZHkudHJpYWdlLnJ1bGVCYXNlZFNjb3JlKS50b0JlR3JlYXRlclRoYW4oOTApO1xyXG4gICAgICBleHBlY3QoYm9keS5uZXh0U3RlcHMpLnRvQ29udGFpbignSW1tZWRpYXRlIG1lZGljYWwgYXR0ZW50aW9uJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHBlcmZvcm0gcnVsZS1iYXNlZCB0cmlhZ2UgZm9yIHJvdXRpbmUgc3ltcHRvbXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVwaXNvZGVJZCA9ICdlcGlzb2RlLTEyMyc7XHJcbiAgICAgIGNvbnN0IGVwaXNvZGUgPSB7XHJcbiAgICAgICAgLi4uY3JlYXRlTW9ja0VwaXNvZGUoZXBpc29kZUlkKSxcclxuICAgICAgICBzeW1wdG9tczoge1xyXG4gICAgICAgICAgcHJpbWFyeUNvbXBsYWludDogJ21pbGQgaGVhZGFjaGUnLFxyXG4gICAgICAgICAgZHVyYXRpb246ICcxIGRheScsXHJcbiAgICAgICAgICBzZXZlcml0eTogNCxcclxuICAgICAgICAgIGFzc29jaWF0ZWRTeW1wdG9tczogW10sXHJcbiAgICAgICAgICBpbnB1dE1ldGhvZDogSW5wdXRNZXRob2QuVEVYVFxyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KHsgZXBpc29kZUlkIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayBlcGlzb2RlIHJldHJpZXZhbFxyXG4gICAgICBtb2NrRG9jQ2xpZW50U2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBJdGVtOiBlcGlzb2RlIH0pO1xyXG4gICAgICAvLyBNb2NrIGVwaXNvZGUgdXBkYXRlXHJcbiAgICAgIG1vY2tEb2NDbGllbnRTZW5kLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7fSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKGV2ZW50KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xyXG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShyZXN1bHQuYm9keSk7XHJcbiAgICAgIGV4cGVjdChib2R5LnRyaWFnZS51cmdlbmN5TGV2ZWwpLnRvQmUoVXJnZW5jeUxldmVsLlJPVVRJTkUpO1xyXG4gICAgICBleHBlY3QoYm9keS5uZXh0U3RlcHMpLnRvQ29udGFpbignUm91dGluZSBjYXJlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZWxmLWNhcmUgc3ltcHRvbXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVwaXNvZGVJZCA9ICdlcGlzb2RlLTEyMyc7XHJcbiAgICAgIGNvbnN0IGVwaXNvZGUgPSB7XHJcbiAgICAgICAgLi4uY3JlYXRlTW9ja0VwaXNvZGUoZXBpc29kZUlkKSxcclxuICAgICAgICBzeW1wdG9tczoge1xyXG4gICAgICAgICAgcHJpbWFyeUNvbXBsYWludDogJ21pbm9yIHNjcmF0Y2gnLFxyXG4gICAgICAgICAgZHVyYXRpb246ICcxIGhvdXInLFxyXG4gICAgICAgICAgc2V2ZXJpdHk6IDIsXHJcbiAgICAgICAgICBhc3NvY2lhdGVkU3ltcHRvbXM6IFtdLFxyXG4gICAgICAgICAgaW5wdXRNZXRob2Q6IElucHV0TWV0aG9kLlRFWFRcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZU1vY2tFdmVudCh7IGVwaXNvZGVJZCB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIE1vY2sgZXBpc29kZSByZXRyaWV2YWxcclxuICAgICAgbW9ja0RvY0NsaWVudFNlbmQubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgSXRlbTogZXBpc29kZSB9KTtcclxuICAgICAgLy8gTW9jayBlcGlzb2RlIHVwZGF0ZVxyXG4gICAgICBtb2NrRG9jQ2xpZW50U2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe30pO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoMjAwKTtcclxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xyXG4gICAgICBleHBlY3QoYm9keS50cmlhZ2UudXJnZW5jeUxldmVsKS50b0JlKFVyZ2VuY3lMZXZlbC5TRUxGX0NBUkUpO1xyXG4gICAgICBleHBlY3QoYm9keS5uZXh0U3RlcHMpLnRvQ29udGFpbignU2VsZi1jYXJlJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgRHluYW1vREIgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KHsgZXBpc29kZUlkOiAnZXBpc29kZS0xMjMnIH0pO1xyXG4gICAgICBcclxuICAgICAgbW9ja0RvY0NsaWVudFNlbmQubW9ja1JlamVjdGVkVmFsdWVPbmNlKG5ldyBFcnJvcignRHluYW1vREIgZXJyb3InKSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKGV2ZW50KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSg1MDApO1xyXG4gICAgICBleHBlY3QoSlNPTi5wYXJzZShyZXN1bHQuYm9keSkpLnRvRXF1YWwoe1xyXG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yIGR1cmluZyB0cmlhZ2UgYXNzZXNzbWVudCdcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBBSSBzZXJ2aWNlIGVycm9ycyBieSBmYWxsaW5nIGJhY2sgdG8gcnVsZS1iYXNlZCBhc3Nlc3NtZW50JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBlcGlzb2RlSWQgPSAnZXBpc29kZS0xMjMnO1xyXG4gICAgICBjb25zdCBlcGlzb2RlID0ge1xyXG4gICAgICAgIC4uLmNyZWF0ZU1vY2tFcGlzb2RlKGVwaXNvZGVJZCksXHJcbiAgICAgICAgc3ltcHRvbXM6IHtcclxuICAgICAgICAgIHByaW1hcnlDb21wbGFpbnQ6ICdjb21wbGV4IHN5bXB0b21zIHdpdGggbXVsdGlwbGUgaXNzdWVzJyxcclxuICAgICAgICAgIGR1cmF0aW9uOiAnc2V2ZXJhbCBkYXlzJyxcclxuICAgICAgICAgIHNldmVyaXR5OiA2LFxyXG4gICAgICAgICAgYXNzb2NpYXRlZFN5bXB0b21zOiBbJ2ZhdGlndWUnLCAnZGl6emluZXNzJywgJ25hdXNlYScsICd3ZWFrbmVzcyddLFxyXG4gICAgICAgICAgaW5wdXRNZXRob2Q6IElucHV0TWV0aG9kLlRFWFRcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZU1vY2tFdmVudCh7IGVwaXNvZGVJZCB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIE1vY2sgZXBpc29kZSByZXRyaWV2YWxcclxuICAgICAgbW9ja0RvY0NsaWVudFNlbmQubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgSXRlbTogZXBpc29kZSB9KTtcclxuICAgICAgLy8gTW9jayBCZWRyb2NrIGVycm9yXHJcbiAgICAgIG1vY2tCZWRyb2NrQ2xpZW50U2VuZC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdCZWRyb2NrIGVycm9yJykpO1xyXG4gICAgICAvLyBNb2NrIGVwaXNvZGUgdXBkYXRlXHJcbiAgICAgIG1vY2tEb2NDbGllbnRTZW5kLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7fSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKGV2ZW50KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xyXG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShyZXN1bHQuYm9keSk7XHJcbiAgICAgIGV4cGVjdChib2R5LnRyaWFnZS5haUFzc2Vzc21lbnQudXNlZCkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChib2R5LnRyaWFnZS51cmdlbmN5TGV2ZWwpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGVuZm9yY2UgY29zdCBjb250cm9sIGJ5IGxpbWl0aW5nIG9uZSBBSSBjYWxsIHBlciBlcGlzb2RlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBlcGlzb2RlSWQgPSAnZXBpc29kZS0xMjMnO1xyXG4gICAgICBjb25zdCBlcGlzb2RlID0ge1xyXG4gICAgICAgIC4uLmNyZWF0ZU1vY2tFcGlzb2RlKGVwaXNvZGVJZCksXHJcbiAgICAgICAgc3ltcHRvbXM6IHtcclxuICAgICAgICAgIHByaW1hcnlDb21wbGFpbnQ6ICdjb21wbGV4IHN5bXB0b21zIHJlcXVpcmluZyBBSSBhc3Nlc3NtZW50JyxcclxuICAgICAgICAgIGR1cmF0aW9uOiAnc2V2ZXJhbCBkYXlzJyxcclxuICAgICAgICAgIHNldmVyaXR5OiA2LFxyXG4gICAgICAgICAgYXNzb2NpYXRlZFN5bXB0b21zOiBbJ2ZhdGlndWUnLCAnZGl6emluZXNzJywgJ25hdXNlYScsICd3ZWFrbmVzcyddLFxyXG4gICAgICAgICAgaW5wdXRNZXRob2Q6IElucHV0TWV0aG9kLlRFWFRcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRyaWFnZToge1xyXG4gICAgICAgICAgdXJnZW5jeUxldmVsOiBVcmdlbmN5TGV2ZWwuUk9VVElORSxcclxuICAgICAgICAgIHJ1bGVCYXNlZFNjb3JlOiA1NSxcclxuICAgICAgICAgIGFpQXNzZXNzbWVudDogeyB1c2VkOiB0cnVlLCBjb25maWRlbmNlOiAwLjgsIHJlYXNvbmluZzogJ1ByZXZpb3VzIEFJIGFzc2Vzc21lbnQnIH0sXHJcbiAgICAgICAgICBmaW5hbFNjb3JlOiA2MFxyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlTW9ja0V2ZW50KHsgZXBpc29kZUlkIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayBlcGlzb2RlIHJldHJpZXZhbCB3aXRoIGV4aXN0aW5nIEFJIGFzc2Vzc21lbnRcclxuICAgICAgbW9ja0RvY0NsaWVudFNlbmQubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgSXRlbTogZXBpc29kZSB9KTtcclxuICAgICAgLy8gTW9jayBlcGlzb2RlIHVwZGF0ZVxyXG4gICAgICBtb2NrRG9jQ2xpZW50U2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe30pO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoMjAwKTtcclxuICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVzdWx0LmJvZHkpO1xyXG4gICAgICBleHBlY3QoYm9keS5tZXNzYWdlKS50b0JlKCdFcGlzb2RlIGFscmVhZHkgaGFzIHRyaWFnZSBhc3Nlc3NtZW50Jyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZnkgQmVkcm9jayB3YXMgbm90IGNhbGxlZFxyXG4gICAgICBleHBlY3QobW9ja0JlZHJvY2tDbGllbnRTZW5kKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdSZXNwb25zZSBGb3JtYXQnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBwcm9wZXJseSBmb3JtYXR0ZWQgcmVzcG9uc2Ugd2l0aCBDT1JTIGhlYWRlcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVwaXNvZGVJZCA9ICdlcGlzb2RlLTEyMyc7XHJcbiAgICAgIGNvbnN0IGVwaXNvZGUgPSBjcmVhdGVNb2NrRXBpc29kZShlcGlzb2RlSWQpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgZXZlbnQgPSBjcmVhdGVNb2NrRXZlbnQoeyBlcGlzb2RlSWQgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBNb2NrIGVwaXNvZGUgcmV0cmlldmFsIC0gZW5zdXJlIHRoZSBlcGlzb2RlIGlzIHJldHVybmVkXHJcbiAgICAgIG1vY2tEb2NDbGllbnRTZW5kXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IEl0ZW06IGVwaXNvZGUgfSkgIC8vIEZpcnN0IGNhbGw6IGdldEVwaXNvZGVcclxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHt9KTsgICAgICAgICAgICAgICAgLy8gU2Vjb25kIGNhbGw6IHVwZGF0ZUVwaXNvZGVXaXRoVHJpYWdlXHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKGV2ZW50KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmhlYWRlcnMpLnRvRXF1YWwoe1xyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJ1xyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHJlc3VsdC5ib2R5KTtcclxuICAgICAgZXhwZWN0KGJvZHkpLnRvSGF2ZVByb3BlcnR5KCdtZXNzYWdlJyk7XHJcbiAgICAgIGV4cGVjdChib2R5KS50b0hhdmVQcm9wZXJ0eSgnZXBpc29kZUlkJyk7XHJcbiAgICAgIGV4cGVjdChib2R5KS50b0hhdmVQcm9wZXJ0eSgndHJpYWdlJyk7XHJcbiAgICAgIGV4cGVjdChib2R5KS50b0hhdmVQcm9wZXJ0eSgnbmV4dFN0ZXBzJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il19